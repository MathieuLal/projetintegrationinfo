strategy(title="UT Bot Alerts", overlay = true, initial_capital = 100)

a = input(1,     title = "Key Vaule. 'This changes the sensitivity'")
c = input(1,    title = "ATR Period")
h = input(false, title = "Signals from Heikin Ashi Candles")

xATR  = atr(c)
nLoss = a * xATR

src = h ? security(heikinashi(syminfo.tickerid), timeframe.period, close, lookahead = false) : close

xATRTrailingStop = 0.0
xATRTrailingStop := iff(src > nz(xATRTrailingStop[1], 0) and src[1] > nz(xATRTrailingStop[1], 0), max(nz(xATRTrailingStop[1]), src - nLoss),
   iff(src < nz(xATRTrailingStop[1], 0) and src[1] < nz(xATRTrailingStop[1], 0), min(nz(xATRTrailingStop[1]), src + nLoss), 
   iff(src > nz(xATRTrailingStop[1], 0), src - nLoss, src + nLoss)))
 
pos = 0   
pos :=	iff(src[1] < nz(xATRTrailingStop[1], 0) and src > nz(xATRTrailingStop[1], 0), 1,
   iff(src[1] > nz(xATRTrailingStop[1], 0) and src < nz(xATRTrailingStop[1], 0), -1, nz(pos[1], 0))) 
   
xcolor = pos == -1 ? color.red: pos == 1 ? color.green : color.blue 

ema   = ema(src,1)
above = crossover(ema, xATRTrailingStop)
below = crossover(xATRTrailingStop, ema)

buy  = src > xATRTrailingStop and above 
sell = src < xATRTrailingStop and below


strategy.entry("Long", strategy.long, 0.006, when = buy)
strategy.close("Long", when = sell)

longstring = "Input your custom alert message here. In and put {{strategy.order.alert_message}} in Message box."
shortstring = "Input your custom alert message here. in and put {{strategy.order.alert_message}} in Message box."

var string long = na
var string short = na

if (input(true, title="Show Long Alert", defval=true))
    long := input("Long", title="Long Alert Message", type=input.string, tooltip=longstring)

if (input(true, title="Show Short Alert", defval=true))
    short := input("Short", title="Short Alert Message", type=input.string, tooltip=shortstring)

if (buy)
    alert("Long")

if (sell)
    alert("Short")

plotshape(buy,  title = "Buy",  text = 'Buy',  style = shape.labelup,   location = location.belowbar, color= color.green, textcolor = color.white, transp = 0, size = size.tiny)
plotshape(sell, title = "Sell", text = 'Sell', style = shape.labeldown, location = location.abovebar, color= color.red,   textcolor = color.white, transp = 0, size = size.tiny)